<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="hr" xml:lang="hr"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Nikola N. Grubor">
<meta name="description" content="Eksperiment je do skoro bio jedini način da se ispitaju prirodni fenomeni, ekskluzivno dostupan samo naukama koje mogu lako da ih izvode. Kauzalno, uzročno-posledično, zaključivanje je pravi naučni cilj. Džudea Perl je popularizovao način kojim možemo opservacije pretvoriti u randomizovane eksperimente, kako bi od njih dobili odgovore na uzročna pitanja.">

<title>Nikola N. Grubor - Kauzalno zaključivanje je moguće iz opservacionih studija</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../">
<link href="../../../../icon.png" rel="icon" type="image/png">
<script src="../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Nema rezultata",
    "search-matching-documents-text": "slična dokumenta",
    "search-copy-link-title": "Kopiraj link za pretraživanje",
    "search-hide-matches-text": "Sakrij dodatne rezultate",
    "search-more-match-text": "još rezultat u ovom dokumentu",
    "search-more-matches-text": "još rezultata u ovom dokumentu",
    "search-clear-button-title": "Obriši",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Odustani",
    "search-submit-button-title": "Predaj",
    "search-label": "Pretraži"
  }
}</script>
<meta name="mermaid-theme" content="forest">
<script src="../../../../site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="../../../../site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="../../../../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../../styles.css">
<meta name="twitter:title" content="Nikola N. Grubor - Kauzalno zaključivanje je moguće iz opservacionih studija">
<meta name="twitter:description" content="Eksperiment je do skoro bio jedini način da se ispitaju prirodni fenomeni, ekskluzivno dostupan samo naukama koje mogu lako da ih izvode. Kauzalno, uzročno-posledično, zaključivanje je pravi naučni cilj. Džudea Perl je popularizovao način kojim možemo opservacije pretvoriti u randomizovane eksperimente, kako bi od njih dobili odgovore na uzročna pitanja.">
<meta name="twitter:image" content="https://nikola-grubor.github.io/myblog/posts/sr/kauzalno-zakljucivanje/observation.jpg">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../../index.html">
    <span class="navbar-title">Nikola N. Grubor</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Pretraži"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Prekidač navigacije" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../myblog/index.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools tools-wide">
    <a href="https://twitter.com/n_grubor" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/nikola-grubor" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
    <a href="https://www.linkedin.com/in/herr-grubor/" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-linkedin"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Prekidač za tamnu temu"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Kauzalno zaključivanje je moguće iz opservacionih studija</h1>
                  <div>
        <div class="description">
          Eksperiment je do skoro bio jedini način da se ispitaju prirodni fenomeni, ekskluzivno dostupan samo naukama koje mogu lako da ih izvode. Kauzalno, uzročno-posledično, zaključivanje je pravi naučni cilj. Džudea Perl je popularizovao način kojim možemo opservacije pretvoriti u randomizovane eksperimente, kako bi od njih dobili odgovore na uzročna pitanja.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">statistika</div>
                <div class="quarto-category">kauzalnost</div>
                <div class="quarto-category">srpski</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Autor</div>
      <div class="quarto-title-meta-contents">
               <p><a href="https://nikola-grubor.github.io">Nikola N. Grubor</a> </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Objavljeno</div>
      <div class="quarto-title-meta-contents">
        <p class="date">7/08/2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Na ovoj stranici</h2>
   
  <ul>
  <li><a href="#kletva-korelacija" id="toc-kletva-korelacija" class="nav-link active" data-scroll-target="#kletva-korelacija">Kletva korelacija</a></li>
  <li><a href="#šta-je-kauzalno-zaključivanje" id="toc-šta-je-kauzalno-zaključivanje" class="nav-link" data-scroll-target="#šta-je-kauzalno-zaključivanje">Šta je kauzalno zaključivanje?</a>
  <ul class="collapse">
  <li><a href="#galton-otkriva-regresiju" id="toc-galton-otkriva-regresiju" class="nav-link" data-scroll-target="#galton-otkriva-regresiju">Galton otkriva regresiju</a></li>
  <li><a href="#konfaunder-ili-skrivena-treća-varijabla" id="toc-konfaunder-ili-skrivena-treća-varijabla" class="nav-link" data-scroll-target="#konfaunder-ili-skrivena-treća-varijabla">Konfaunder, ili skrivena treća varijabla</a></li>
  <li><a href="#kauzalna-salata" id="toc-kauzalna-salata" class="nav-link" data-scroll-target="#kauzalna-salata">Kauzalna Salata</a></li>
  </ul></li>
  <li><a href="#kauzalni-dijagrami" id="toc-kauzalni-dijagrami" class="nav-link" data-scroll-target="#kauzalni-dijagrami">Kauzalni dijagrami</a>
  <ul class="collapse">
  <li><a href="#do-račun-jezik-intervenisanja" id="toc-do-račun-jezik-intervenisanja" class="nav-link" data-scroll-target="#do-račun-jezik-intervenisanja">do-Račun: Jezik Intervenisanja</a>
  <ul class="collapse">
  <li><a href="#backdoor-kriterijum" id="toc-backdoor-kriterijum" class="nav-link" data-scroll-target="#backdoor-kriterijum">Backdoor Kriterijum</a></li>
  <li><a href="#front-door-kriterijum" id="toc-front-door-kriterijum" class="nav-link" data-scroll-target="#front-door-kriterijum">Front-door Kriterijum</a></li>
  </ul></li>
  <li><a href="#dr-džon-snou-i-prva-instrumentalna-varijabla" id="toc-dr-džon-snou-i-prva-instrumentalna-varijabla" class="nav-link" data-scroll-target="#dr-džon-snou-i-prva-instrumentalna-varijabla">Dr Džon Snou i prva instrumentalna varijabla</a></li>
  </ul></li>
  <li><a href="#zaključak" id="toc-zaključak" class="nav-link" data-scroll-target="#zaključak">Zaključak</a>
  <ul class="collapse">
  <li><a href="#reference" id="toc-reference" class="nav-link" data-scroll-target="#reference">Reference</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<div class="cell">
<style type="text/css">
p {
  text-align: justify
}
</style>
</div>
<p>Eksperiment je do skoro bio jedini način da se ispitaju prirodni fenomeni, ekskluzivno dostupan samo naukama koje mogu lako da ih izvode. Istraživač koji bi hteo da ispita prirodu neeksperimentalnim metodama (zato što je izvođenje eksperimenta neetičko ili nemoguće) je bio ograničen na ispitivanje korelacija. Kada u prirodi vidimo dve stvari koje se dešavaju zajedno, ne možemo zasigurno znati koja uzrokuje koju, niti da li su uopšte povezane (takođe, postoje uzroci koji uopšte nisu korelisani).<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> Svet medicine, a i nauke njoj sličnoj, bile su ograničene na tvrdnje asocijacija. Naučnici su želeli da kažu <span class="math inline">\(A\)</span> uzrokuje <span class="math inline">\(B\)</span> (<span class="math inline">\(A\rightarrow B\)</span>), ali nisu smeli, jer su takve tvrdnje bile prejake za statističke metode. Medicinska literatura je prepuna reči koje izbegavaju uzročne tvrdnje — kao što su: veza, asocijacija, korelacija, značajna povezanost <span class="citation" data-cites="hernán2018">(<a href="#ref-hernán2018" role="doc-biblioref">Hernán, 2018</a>)</span>. Možemo li bez ikakvog intervenisanja, tj. samo gledanjem prirode, doći do zaključaka šta bi se desilo da zapravo uradimo nešto?</p>
<section id="kletva-korelacija" class="level1">
<h1>Kletva korelacija</h1>
<p>Ono što čoveka najviše razlikuje od životinja je sposobnost da zamisli <em>bliske moguće svetove</em>. Bliski mogući svetovi su odgovori na pitanje: “Šta bi bilo, kad bi bilo?” Tokom evolucije, bliski pretci modernog čoveka su stekli sposobnost da komuniciraju ideje i sarađuju na sve kompleksnije načine. Šta god da je dovelo do ove prosocijalne pojave, dalo je čoveku mogućnost da zamisli nepostojeće — uz koju je došla i sposobnost planiranja. <span class="citation" data-cites="pearl2018">Pearl &amp; Mackenzie (<a href="#ref-pearl2018" role="doc-biblioref">2018</a>)</span> u svojoj knjizi opisuju tri stepenika kognitivnog razmišljanja u zavisnosti od toga na kakva pitanja ono može dati odgovor.</p>
<ul>
<li><p>Prvi stepenik – Asocijacije<br>
Šta ako vidim?<br>
Primer: Ako pacijent ima ovaj simptom, on mi govori da…?</p></li>
<li><p>Drugi stepenik – Intervencija<br>
“Šta ako uradim?”<br>
Primer: Da li će me proći glavobolja ako uzmem aspirin?</p></li>
<li><p>Treći stepenik – Kontračinjenice (eng. counterfactual)<br>
“Šta da sam uradio? Zašto?”<br>
Primer: Da li mi je aspirin zaustavio glavobolju?</p></li>
</ul>
<p>Velika većina istraživanja se bazira na asocijacijama. Posledica takvih istraživanja je da niko ne može pretpostaviti šta će se desiti ako uradimo nešto — tj. teško je predvideti posledice intervencija. To je ogroman problem. Skoro smo u Beogradu imali veliko nevreme. Vetar je doslovno odnosio krovove. Te dve stvari je svako mogao da primeti (prvi stepenik, asocijacija; <span class="math inline">\(\rho = \text{corr}(vetar, odnošenje\,krova)\)</span>), međutim ako bi se neko popeo na svoj krov i počeo da baca crepove, ma koliko se trudio ne bi prizvao vetar (kauzalna strelica ide <span class="math inline">\(vetar \rightarrow odnošenje \,krova\)</span>, a ne suprotno). Koncept kauzalne strelice ćemo dodatno istražiti u narednim poglavljima, pogotovo kada budemo pričali o kauzalnim dijagramima. Jedno po jedno.</p>
</section>
<section id="šta-je-kauzalno-zaključivanje" class="level1">
<h1>Šta je kauzalno zaključivanje?</h1>
<p>Kauzalno, uzročno-posledično, zaključivanje je pravi naučni cilj. Ponekad je dobro imati predviđanja, ali uglavnom ono što želimo je da razumemo fenomen kako bismo mogli da intervenišemo tj. promenimo nešto. Produžimo životni vek, sprečimo bolest, smanjimo rizik, planiramo projekat, itd. U tom slučaju ne možemo vršiti zaključivanja uz pomoć prvog stepenika, već pričamo o drugom stepeniku — intervencijama. Tad nas <a href="https://www.tylervigen.com/spurious-correlations">korelacije mogu zavarati</a>. Treba nam način da otkrijemo kako su stvari zapravo povezane, a da se ne zavaravamo lažnim asocijacijama. Interesantno je kako je Francis Galton (1822-1911), Britanski učenjak, u svojoj potrazi za uzrocima, nabasao prvo na korelaciju (<span class="math inline">\(\rho\)</span>). Tim putem moramo proći i mi.</p>
<section id="galton-otkriva-regresiju" class="level2">
<h2 class="anchored" data-anchor-id="galton-otkriva-regresiju">Galton otkriva regresiju</h2>
<p>Francis Galton je tražio uzročno objašnjenje nasleđivanja visine ljudi.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> Elem, Galton je primetio da viši očevi imaju prosečno više sinove, ali ne više od sebe. Sinovi niskih očeva bili su, u proseku, niži ali ne niski kao svoji očevi (<a href="#fig-regresija-1" class="quarto-xref">Figura&nbsp;1 (a)</a>). Galton je ovaj fenomen približavanja visine pojedinca ka prosečnoj vrednosti visine kroz generacije nazvao “regresija ka mediokritetu.”<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> Na trenutak je delovalo kao da ovaj “zakon” regresije sprečava da visoki ljudi postaju sve viši, a niži ljudi sve niži (dok ne nestanu?). Galtonov pokušaj kauzalnog objašnjenja ponašao se nešto nalik elastičnoj opruzi koja se vraća u svoj prvobitni oblik kada se istegne ili sabije. Galton je pogrešio, ali nije jedini. Mnogli ljudi danas prave sličnu grešku kada traže uzročno objašnjenje, na primer, košarkaškog igrača koji je odigrao dobru prošlu sezonu u odnosu na trenutnu. Neki uzroci sigurno postoje, ali bi se takve pojave dešavle i samo pukom srećom.</p>
<p>Galton je ubrzo počeo da meri odnose između visine i raznih drugih vrednosti, poput dužine podlaktice. Svaka od tih merenja je pokazala istu pojavu regresije ka proseku. Očigledno je da visina nije uzrok dužine podlaktice, ili obrnuto (<span class="math inline">\(Visina \nrightarrow Dužina\,podlaktice\)</span> ili <span class="math inline">\(Visina \nleftarrow Dužina\,podlaktice\)</span>). Štaviše, obe vrednosti sigurno imaju genetske i sredinske uzroke. Regresija ka proseku (kako je danas poznata) je statistička pojava prisutna svuda oko nas — u tom trenutku Galton je nije prepoznao, već je mislio da je nabasao na zakon nasleđivanja. Do 1889. je shvatio da je zapravo otkrio korelaciju, a da je regresija ka proseku posledica sreće (<span class="math inline">\(Visina = Prava\,visina + sreća\)</span>).</p>
<p>Regresija je način da se povežu dve numeričke vrednosti, a fenomen regresije ka proseku nastaje između bilo koje dve korelisane vrednosti. Regresiona linija je ona linija koja najbolje predviđa nepoznatu varijablu kada nam je jedna poznata. Zapravo postoje dve regresione linije (<a href="#fig-regresija-1" class="quarto-xref">Figura&nbsp;1 (a)</a> i <a href="#fig-regresija-2" class="quarto-xref">Figura&nbsp;1 (b)</a>). Obe linije predviđaju jednako dobro. Jednačine regresionih linija su različite, ali je situacija potpuno simetrična. Kada nam je poznata visina oca, možemo predviđati visnu sina; sa poznatom visinom sina možemo predviđati visinu oca. Kada je Galton shvatio da se vremenski redosled može potpuno obrnuti odustao je od bilo kakvog pokušaja da tretira regresiju ka proseku kao uzrok. Regresija ka proseku ne može biti uzrok jer ne razlikuje nikakav redosled događaja.</p>
<!-- Dve varijable (visina očeva i sinova) su korelisane ako jedna "predviđa" drugu, a koeficijent korelacije je veći što su obe varijable bliže pravoj liniji. U slučaju savršene korelacije ($\rho = 1$) između visine očeva i njihovih sinova, svaki dodatni centimetar visine oca bi deterministički bio prenesen na sina, što nije slučaj. -->
<div id="fig-regresija" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-regresija-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-regresija" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-regresija-1" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-regresija-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-regresija-1.png" class="img-fluid figure-img" data-ref-parent="fig-regresija" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-regresija-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Očevi predviđaju sinove
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-regresija" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-regresija-2" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-regresija-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-regresija-2.png" class="img-fluid figure-img" data-ref-parent="fig-regresija" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-regresija-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Sinovi predviđaju očeve
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-regresija-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;1: Galtonova regresija visina očeva i sinova. Crvena isprekidana linija prikazuje istu tačku u obe figure. Plava regresiona linija je najbolje predviđanje za datu visinu. Populacija visokih očeva ima niže sinove, dok populacija visokih sinova ima niže očeve.
</figcaption>
</figure>
</div>
<p>Galton je otkrio objektivnu meru povezanosti dve varijable. Kasnije će njegov učenik Karl Pirson definisati Pirsonov koeficijent (<span class="math inline">\(\rho\)</span> ili <span class="math inline">\(r\)</span>) koji je dobro poznat svakom naučniku. Insistiranje na korišćenju korelacija zarad neke fiktivne “objektivnosti” je unazadilo nauku desetinama godina. Prodaja sladoleda je korelisana sa stopom kriminala, ali nikad ne bismo izmislili priču da objasnimo kako prodaja sladoleda utiče na kriminal — jasno nam je da su slučajno povezani. Korelacije ne govore ništa o uzrocima. Mogu poslužiti u predviđanjima, ali nemaju nikakvu eksplanatornu vrednost. Zaključivanje o intervencijama je nepouzdano. Provlačenjem kroz skupštinu zakona o zabrani prodaje sladoleda, neće smanjiti kriminal.</p>
<p>Zašto su prodaja sladoleda i kriminal povezani; gde se kriju uzroci?</p>
</section>
<section id="konfaunder-ili-skrivena-treća-varijabla" class="level2">
<h2 class="anchored" data-anchor-id="konfaunder-ili-skrivena-treća-varijabla">Konfaunder, ili skrivena treća varijabla</h2>
<p>Konfaunder, od Latinskog <em>confundere</em>, što znači “umešano”, je varijabla čiji efekat utiče na izloženost i ishod, stvarajući lažnu asocijaciju. Na primer, ako procenjujemo efekat leka na bolest (<span class="math inline">\(Lek \rightarrow Bolest\)</span>), ali nam je kontrolna grupa starija od ispitne, <span class="math inline">\(Starost\)</span> postaje konfaunder (<span class="math inline">\(Lek \leftarrow Starost \rightarrow Bolest\)</span>) — ispitivač je sam stvorio lažnu asocijaciju. Svaki uticaj <span class="math inline">\(Leka\)</span> sad će biti lažno izmenjen uticajem <span class="math inline">\(Starosti\)</span>. Srećom, ako smo prikupili podatke o starosti pacijenata, lako možemo raspetljati efekte treće varijable od <span class="math inline">\(Leka\)</span>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Dodatak: Matematičko objašnjenje kontrolisanja treće varijable
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Regresijom povlačimo najbolju liniju kroz oblak podataka. Za objašnjenje (<span class="math inline">\(X\)</span>) i ishod (<span class="math inline">\(Y\)</span>), jednačina regresione linije bi izgledala: <span class="math inline">\(Y = aX + b\)</span>. U tom slučaju, jedna jedinica povećanja <span class="math inline">\(X\)</span> će, u proseku, povećati <span class="math inline">\(Y\)</span> za <span class="math inline">\(a\)</span>-jedinica. Ako nema nikakvih konfaundera onda je to procena naše intervencije. Ukoliko postoji neka treća varijabla, onda <span class="math inline">\(a\)</span> daje prosečan trend, tj. korelaciju, a ne kauzalni efekat. Ako pretpostavimo da imamo konfaunder <span class="math inline">\(Z\)</span>, onda varijable <span class="math inline">\(X, Y, Z\)</span> prave “oblak” u 3D prostoru, i naša regresiona linija postaje ravan <span class="math inline">\(Y = aX + bZ + c\)</span>, ukoliko uvrstimo <span class="math inline">\(Z\)</span> u regresionu jednačinu. Koeficijent <span class="math inline">\(a\)</span> onda predstavlja parcijalni regresioni koeficijent “kontrolisan” za <span class="math inline">\(Z\)</span>. Tako smo uklonili neželjeni efekat <span class="math inline">\(Z\)</span> i dobili pravi efekat <span class="math inline">\(X\)</span> na <span class="math inline">\(Y\)</span> <span class="citation" data-cites="pearl2018">(<a href="#ref-pearl2018" role="doc-biblioref">Pearl &amp; Mackenzie, 2018</a>)</span>.</p>
</div>
</div>
</div>
<!-- ::: callout-warning -->
<!-- Problemi sa linearnim prepostavkama su sledeći: (1) Ne mogu da pretpostave nelinearne odnose izmedju varijabli. (2) Ne mogu da opišu "threashold" efekte, npr. lek koji prestaje da deluje iznad neke doze. (3) Ne mogu da opišu interakcije između varijabli (proveri @pearl2018 p. 286). -->
<!-- ::: -->
</section>
<section id="kauzalna-salata" class="level2">
<h2 class="anchored" data-anchor-id="kauzalna-salata">Kauzalna Salata</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p>Kada znamo da je moguće kontrolisati za lažne asocijacije, da li treba da kontrolišemo za što više varijabli kako bi naši efekti bili tačniji? Nažalost, ubacivanje varijabli u regresiju bez razmišljanja nam može uništiti procenu. Retki su statistički kursevi koji uče istraživače kako da biraju kontrolne varijable, a njihovo nasumično ubacivanje može dovesti do katastrofalnih posledica. Kontrolom nekih varijabli može se dobiti pristrasna (pogrešna) procena efekta, a ponekad i kompletno obrnutog znaka, tj. smera efekta <span class="citation" data-cites="cinelli2020">(<a href="#ref-cinelli2020" role="doc-biblioref">Cinelli i ostali, 2020</a>)</span>.</p>
</div><div class="column" style="width:50%;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="salad.webp" class="img-fluid figure-img"></p>
<figcaption>Naučnik trpa sve varijable u svoju salatu.</figcaption>
</figure>
</div>
</div>
</div>
<p><strong>Kauzalna salata</strong> je procedura (ne samo regresija) kojom se uzima lista varijabli i na osnovu njih vrši nekakvo kauzalno zaključivanje <span class="citation" data-cites="mcelreath2021">(<a href="#ref-mcelreath2021" role="doc-biblioref">McElreath, 2021</a>)</span>. Nijedna veličina uzorka neće pretvoriti salatu u smisao. Ali postoji rešenje za biranje kontrolnih varijabli, <strong>kauzalni dijagrami</strong>.</p>
</section>
</section>
<section id="kauzalni-dijagrami" class="level1">
<h1>Kauzalni dijagrami</h1>
<p>U svom radu “Da li biolozi mogu da poprave radio? — ili, šta sam naučio tokom izučavanje apoptoze,” <span class="citation" data-cites="lazebnik2002">Lazebnik (<a href="#ref-lazebnik2002" role="doc-biblioref">2002</a>)</span> govori kako su biološke nauke oštećenje manjkom formalnog pristupa biološkim sistemima. Jedan od načina da se formalizuju pretpostavke u opservacionim studijama, tj. prirodnim eksperimentima su <em>usmereni aciklični grafovi</em> (eng. Directed Acyclic Graphs, DAGs). Putem ovih dijagrama mogu se predstaviti uticaji za koje naučnik smatra da su u osnovi nekog procesa (<a href="#fig-confounder" class="quarto-xref">Figura&nbsp;2</a>).</p>
<p>Džudea Perl je popularizovao način kojim možemo opservacije (prvi stepenik) pretvoriti u randomizovane eksperimente, kako bi od njih dobili odgovore na uzročna pitanja (stepenik dva i tri). Naime, definisanjem kauzalnog dijagrama naučnik može saznati koje mu varijable trebaju da dobije odgovor na postavljeno pitanje. Jednom definisan, kauzalni dijagram eliminiše bilo kakvu zbunjenost koje kontrolne varijable treba uključiti u regresiju, a koje ne.<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-confounder" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-confounder-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="index_files/figure-html/fig-confounder-1.png" class="img-fluid figure-img" width="480">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-confounder-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;2: Šematski prikaz klasičnog kauzalnog dijagrama sa konfaunderom (<code>Z</code>). Strelice pokazuju tok informacija iz jedne varijable u drugu.
</figcaption>
</figure>
</div>
</div>
</div>
<p>Kauzalni dijagrami se prave naučnim razmišljanjem. Uzroci se ne mogu dobiti iz podataka bez pretpostavki. Kauzalni dijagrami su naučni model procesa koji stoji iza podataka i realizuje ih. Uz pomoć kauzalnog dijagrama naučnik može transparentno da definiše uticaje koji prožimaju fenomen koji istražuje. Interakcije u opservacionoj studiji se onda mogu transformisati u randomizovani eksperiment uz pomoć do-Računa (eng. do-Calculus)! Do-Račun je matematički alat kojim možemo analizirati uzroke iz prirodnih eksperimenata. Mnoge vrste zaključaka nam onda postaju dostupne, kao i istraživanja naučnih pitanja za koje nije moguće napraviti randomizovani eksperiment.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Upozorenje
</div>
</div>
<div class="callout-body-container callout-body">
<p>Ponekad regresioni koeficijenti predstavljaju kauzalne efekte, a ponekad ne. Sve zavisi od kauzalnog dijagrama! Štaviše, ne smeju se svi regresioni koeficijenti iz jedne jednačine tretirati kao kauzalni efekti <span class="citation" data-cites="westreich2013">(<a href="#ref-westreich2013" role="doc-biblioref">Westreich &amp; Greenland, 2013</a>)</span>.</p>
</div>
</div>
<section id="do-račun-jezik-intervenisanja" class="level2">
<h2 class="anchored" data-anchor-id="do-račun-jezik-intervenisanja">do-Račun: Jezik Intervenisanja</h2>
<p>Recimo da smo posmatranjem prikupili podatke o uzimanju određenog leka u populaciji. Nas zanima kako on utiče na pojavu infarkta. Takođe ćemo pretpostaviti da pol utiče na uzimanje leka, što nije nemoguća pretpostavka. <a href="#fig-backdoor" class="quarto-xref">Figura&nbsp;3</a> daje potencijalni kauzalni dijagram za ovaj scenario. Savršeni randomizovani eksperiment bi jednako dodelio lek svakom polu, ali trenutno imamo dostupnu samo opservacionu studiju. Do-Račun koristi matematičku operaciju koje se obeležava sa <span class="math inline">\(do(x)\)</span> da označi intervenciju ili kontračinjenicu. <span class="math inline">\(do(x)\)</span> simulira fizičku intervenciju fiksiranja izabrane varijable menjajući je sa konstantom (<span class="math inline">\(X = x\)</span>), dok ostatak kauzalnog modela ostaje nepromenjen.</p>
<p>Ono što mi želimo da procenimo je efekat leka na infarkt (<span class="math inline">\(Lek \rightarrow Infarkt\)</span>) i to možemo da izrazimo sa <span class="math inline">\(P(Infarkt\,|\,do(Lek))\)</span>. Prevedeno, ovaj izraz znači: “Verovatnoća da se infarkt desio, ukoliko smo mi odredili lek.” Do-Račun nam omogućava da statistički izolujemo efekat <span class="math inline">\(Leka\)</span> na <span class="math inline">\(Infarkt\)</span> ukoliko nam kauzalni dijagram oslikava moguću realnost. Time smo dobili transformisali kauzalni dijagram na <a href="#fig-backdoor-adj" class="quarto-xref">Figura&nbsp;4</a>, gde se jasno vidi obrisan uticaj <span class="math inline">\(Pola\)</span> na <span class="math inline">\(Lek\)</span>.</p>
<p>Kriterijumi po kojim se mogu odrediti dobre kontrolne varijable, za bilo koji kauzalni dijagram su <strong>Backdoor</strong> i <strong>Front-door</strong> kriterijum.</p>
<!-- Do-Račun omogućava konstrukciju dokaza, ali ne pomaže da se dokaz pronađe. -->
<div class="columns">
<div class="column" style="width:45%;">
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div id="fig-backdoor" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-backdoor-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>
<pre class="mermaid mermaid-js" data-label="fig-backdoor">flowchart LR
  Z((Pol)) --&gt; X &amp; Y
  X((Lek)) ==&gt; Y((Infarkt))
  linkStyle 2 stroke:red
  
</pre>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-backdoor-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;3: Kauzalni dijagram uticaja <code>Pola</code> na <code>Lek</code> i <code>Infakrt</code>. <code>Pol</code> je u ovom slučaju konfaunder pošto nas zanima kauzalni efekat <code>Leka</code> na <code>Infarkt</code>
</figcaption>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:10%;">

</div><div class="column" style="width:45%;">
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div id="fig-backdoor-adj" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-backdoor-adj-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>
<pre class="mermaid mermaid-js" data-label="fig-backdoor-adj">flowchart LR
  Z((Pol)) --&gt; Y
  Z((Pol)) x-.-x X
  X(("do(Lek)")) ==&gt; Y((Infarkt))
  linkStyle 2 stroke:red
  
</pre>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-backdoor-adj-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;4: Fiksiranjem, tj. brisanjem strelice iz <code>Pol</code> u <code>Lek</code> smo uklonili uticaj konfaundera na <code>Lek</code>. Sada svaka promena u <code>Infarktu</code> uslovljena promenom <code>Leka</code> odgovara kauzalnom efektu <code>Leka</code>.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
<section id="backdoor-kriterijum" class="level3">
<h3 class="anchored" data-anchor-id="backdoor-kriterijum">Backdoor Kriterijum</h3>
<p>Backdoor kriterijum je pravilo o pronalaženju skupa varijabli, kontrolom kojih bi dobili izolovan efekat izloženosti <span class="math inline">\(X\)</span> na ishod <span class="math inline">\(Y\)</span> — drugačije napisano: <span class="math inline">\(P(Y\,|\,do(X))\)</span>. Intuitivno, blokiranjem svih alternativnih puteva (stelica) kojim je naša varijabla (<span class="math inline">\(X\)</span>) od interesa povezana za ishodom (<span class="math inline">\(Y\)</span>) će izolovati direktnu vezu naše varijable i ishoda (<span class="math inline">\(X \rightarrow Y\)</span>). U tom slučaju, svaka korelacija između <span class="math inline">\(X\)</span> i <span class="math inline">\(Y\)</span> istovremeno odgovara efektu <span class="math inline">\(X\)</span> na <span class="math inline">\(Y\)</span>. Pored toga što je najbitniji kriterijum, izuzetno je intuitivan i može se upotrebiti kada se dijagram analizira vizuelno. Backdoor kriterijum je primenjen na <a href="#fig-backdoor-adj" class="quarto-xref">Figura&nbsp;4</a>.</p>
<!-- **Metod:** Procena artimetičke sredine efekta u svakom stratumu. Onda weighted average svakog stratuma prema prevalenci u populaciji @fig-backdoor. -->
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Beleška
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Upotreba:</strong> kada smo sigurni da imamo sve podatke o velikom broju (najuticajnijih) konfaundera.</p>
</div>
</div>
</section>
<section id="front-door-kriterijum" class="level3">
<h3 class="anchored" data-anchor-id="front-door-kriterijum">Front-door Kriterijum</h3>
<p>Front-door kriterijum je malo komplikovaniji. Recimo da radimo opservacionu studiju, ali ne možemo da prikupimo podatke o genu podložnosti ka infarktu (možda ne znamo da takav postoji). Ono što jesmo prikupili su podaci o <span class="math inline">\(Leku\)</span>, <span class="math inline">\(Krvnom\,Pritisku\)</span> i <span class="math inline">\(Infarktu\)</span>. Ako pogledamo <a href="#fig-frontdoor-1" class="quarto-xref">Figura&nbsp;5</a>, videćemo da <span class="math inline">\(Krvni\,Pritisak\)</span> stoji na putu efekta <span class="math inline">\(Leka\)</span> na <span class="math inline">\(Infakrt\)</span>. Takva varijabla se zove <strong>medijator</strong>.<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a> Ne možemo iskoristiti Backdoor kriterijum jer nemamo podatke o <span class="math inline">\(Infarkt\,Gen\)</span>-u, te ga ne možemo blokirati.</p>
<div class="columns">
<div class="column" style="width:45%;">
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div id="fig-frontdoor-1" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-frontdoor-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>
<pre class="mermaid mermaid-js" data-label="fig-frontdoor-1">flowchart LR
  Z((Infarkt Gen)) --&gt; X &amp; Y
  X((Lek)) ==&gt; M((Krvni Pritisak)) 
  M ==&gt; Y((Infarkt))
  style Z stroke-dasharray: 5 5, fill:#edffc4
  
</pre>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-frontdoor-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;5: Kauzalni dijagram pogodan za Front-door kriterijum. Isprekidanim krugom je obeležena varijabla o kojoj ne znamo ništa, samo spekulišemo da postoji.
</figcaption>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:10%;">

</div><div class="column" style="width:45%;">
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div id="fig-frontdoor-2" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-frontdoor-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>
<pre class="mermaid mermaid-js" data-label="fig-frontdoor-2">flowchart LR
  Z((Infarkt Gen)) --&gt; X &amp; Y
  Z x-.-x M
  X((Lek)) ==&gt; M((Krvni Pritisak)) 
  M ==&gt; Y((Infarkt))
  style Z stroke-dasharray: 5 5, fill:#edffc4
  linkStyle 3 stroke:blue
  linkStyle 4 stroke:red
  
</pre>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-frontdoor-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;6: Veza između <code>Infarkt Gena</code> i <code>Krvnog Pritiska</code> ne sme da postoji kako bi Front-door kriterijum bio validan. Kada se nađemo u situaciji gde je nemoguće iskoristiti Backdoor kriterijum, treba potražiti postojanje zaštićene varijable koje je medijator efekta <code>Leka</code> na <code>Infarkt</code>.
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</div>
<p>Ono što možemo da procenimo je kauzalni efekat Leka na Krvni Pritisak (<span class="math inline">\(Lek\,{\color{blue}\rightarrow}\,Krvni\,pritisak\)</span>). Za to nam ne treba nikakva kontrolna varijabla (<a href="#fig-frontdoor-1" class="quarto-xref">Figura&nbsp;5</a> pokazuje da nema strelice iz Infarkt Gena u Krvni Pritisak (<span class="math inline">\(Infarkt\,Gen \nrightarrow Krvni\,pritisak\)</span>). Takođe, možemo da uočimo da je razlika između <span class="math inline">\(P(\text{Krvni Pritisak}\,|\,\text{Lek})\)</span> i <span class="math inline">\(P(\text{Krvni Pritisak}\,|\,\text{Bez Leka})\)</span>, prosečan efekat Leka na Krvni Pritisak.</p>
<p><a href="#fig-frontdoor-1" class="quarto-xref">Figura&nbsp;5</a> pokazuje da možemo da procenimo kauzalni efekat Krvnog Pritiska na Infarkt (<span class="math inline">\(Krvni\,Pritisak \,{\color{red}\rightarrow}\,Infarkt\)</span>). <em>Backdoor kriterijum</em> omogućava da blokiramo efekat Leka na Krvni Pritisak. Time smo saznali prosečan efekat prosečan efekat Krvnog Pritiska na Infarkt.</p>
<!-- Tako ćemo dobiti $P(\text{Infarkt}\,|\,do\text{(Lek)})$ i $P(\text{Infarkt}\,|\,do\text{(Bez Leka)})$. -->
<p>Kombinacijom ova dva efekta prostim množenjem (ukoliko je veza linearna) možemo posrednim putem da dobijemo efekat Leka na Infarkt izuzetog od genetskog uticaja Infarkt Gena. Proces izražavanja <span class="math inline">\(P(\text{Infarkt}\,|\,do\text{(Lek)})\)</span> preko verovatnoća koje ne sadrže do-operaciju je zapravo Front-door kriterijum.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Beleška
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Upotreba:</strong> Front-door kriterijum treba tražiti kad god ne možemo da uklonimo uticaj konfaundera Backdoor kriterijumom. U tom slučaju nam je potrebna medijatorska varijabla <em>zaštićena</em> od uticaja konfaundera (uporediti dijagrame <a href="#fig-frontdoor-1" class="quarto-xref">Figura&nbsp;5</a> i <a href="#fig-frontdoor-2" class="quarto-xref">Figura&nbsp;6</a>).</p>
</div>
</div>
</section>
</section>
<section id="dr-džon-snou-i-prva-instrumentalna-varijabla" class="level2">
<h2 class="anchored" data-anchor-id="dr-džon-snou-i-prva-instrumentalna-varijabla">Dr Džon Snou i prva instrumentalna varijabla</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p>Poznata priča o Džon Snouovom zaključku da epidemija dijareje u Londonu potiče od zagađenja pijaće vode ljudskim fekalijama, a ne da je uzrokovana mijazmom (česticama lošeg vazduha) ili siromaštvom, je dobra ilustracija kauzalnog zaključivanja. Ova epidemija je odnela skoro 3,000 Života — uzrok je bilo bitno otkriti. Kako uzročnik, <em>Vibrio cholerae</em>, još uvek nije bio poznat Džon Snou je pred sobom imao nekoliko mogućih objašnjenja. Teorija mijazme, koje je bila popularna, tvrdila je da su uzročnik truležne čestice iz vazduha. Pumpa vode, koju je Snou ugasio, se često pominje kao ključan momenat u borbi protiv epidemije. Međutim, gašenje pumpe je jedva promenilo njen tok <span class="citation" data-cites="pearl2018">(<a href="#ref-pearl2018" role="doc-biblioref">Pearl &amp; Mackenzie, 2018</a> p.&nbsp;246)</span>.</p>
</div><div class="column" style="width:50%;">
<div id="fig-john" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-john-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="johnsnow.jpg" class="img-fluid figure-img" style="width:60.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-john-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;7: Dr Džon Snou
</figcaption>
</figure>
</div>
</div>
</div>
<p>Najbitnij uvid koji je Džon Snou imao je bio kauzalne prirode. Džon Snou je primetio da su se kompanije koje snabdevaju London vodom podelile na one koje su uzimale vodu iz Temze blizu Londonskog mosta (nizvodno od kanalizacije), i one koje nisu. Ove kompanije su, izdelivši grad London u svoje mreže snabdevanja, u stvari randomizovale stanovnike grada na one koji su dobijali zagađenu vodu i one koji nisu. Ti stanovnici su bili raznolikih pozadina po bogatstvu, godinama, statusu, itd. Polozaj kompanije u kauzalnom dijagramu prikazan je na <a href="#fig-instrumental" class="quarto-xref">Figura&nbsp;8</a>.</p>
<p>Varijabla koja prirodno randomizuje opservacije naziva se <strong>instrumentalna varijabla</strong>. Takva varijabla po definiciji ispunjava Backdoor kriterijum, tj. nema nikakve sopstvene uzroke. <a href="#fig-instrumental" class="quarto-xref">Figura&nbsp;8</a> pokazuje da varijabla <span class="math inline">\(Kompanija\)</span> ispunjava sledeće:</p>
<ul>
<li>Nema strelice od <span class="math inline">\(Mijazme\)</span> do <span class="math inline">\(Kompanije\)</span><br>
(kompanije ne prenose efekat mijazme)</li>
<li>Postoji strelica od <span class="math inline">\(Kompanije\)</span> do <span class="math inline">\(Čistoće\,vode\)</span><br>
(kompanije su zaslužne za kvalitet vode)</li>
<li>Nema strelice od <span class="math inline">\(Kompanije\)</span> do <span class="math inline">\(Dijareje\)</span><br>
(nadamo se da kompanije ne zagađuju namerno svoju vodu)</li>
</ul>
<p>Instrumentalna varijabla nam omogućava da uradimo isti trik kao i sa Front-door kriterijumom. Uz pomoć varijable <span class="math inline">\(Kompanija\)</span> moguće je odrediti kauzalni efekat <span class="math inline">\(Čistoće\,vode\)</span> na <span class="math inline">\(Dijareju\)</span> bez kontrolisanja ili prikupljanja dodatnih podataka.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Dodatak: Namera lečenja
</div>
</div>
<div class="callout-body-container callout-body">
<p>U modernom dizajnu istraživanja, namera lečenja (eng. intention-to-treat) vriši funkciju instrumentalne varijable. Kako istraživači ne mogu da kontrolišu da li će se pacijenti zapravo pridržavati dodeljene terapije, svaki procenjeni efekat terapije nakon randomizacije će biti pristrasan. Pogotovo ako ima dosta pacijenata koji odustanu od lečenja. Tako da je zapravo bolje govoriti o “efektu” dodeljivanja terapijskoj grupi. Ovo kao što možete pretpostaviti ima problema sa generalizacijom na okruženja van studije.</p>
</div>
</div>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div id="fig-instrumental" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-instrumental-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>
<pre class="mermaid mermaid-js" data-label="fig-instrumental">flowchart LR
  M(Mijazma, Siromaštvo,...) -.-&gt; W &amp; C
  W(Čistoća Vode) ==&gt; C(Dijareja)
  WC(Kompanija) ==&gt; W
  style M stroke-dasharray: 5 5, fill:#edffc4
  
  
</pre>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-instrumental-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figura&nbsp;8: Kauzalni dijagram epidemije kolere u Londonu. Varijabla <code>Kompanija</code> ima status instrumentalne varijable.
</figcaption>
</figure>
</div>
</div>
</div>
<!-- $b = \frac{ \sf{r_{CWC}}} {\sf{r_{WWC}}}$ je dobijeno iz $\frac{ab} {a}$. -->
<!-- ::: callout-note -->
<!-- Monotonicity: nije bilo pacijenata koji su dodaljeni grupi koja *ne* dobija Lek (Z = 0), a da su nekako ipak dobili lek (X = 1). -->
<!-- ::: -->
<!-- # Interesantne Primene -->
<!-- -   Mediation Analysis: If Smoking -\> Tar -\> Cancer, is all effect of Smoking through Tar? If so, e-cigs could eliminate risk. -->
<!-- -   EET (Effect of Treatment on the Treatet): Ilya Shpitser, Johns Hopkins, counterfactual analysis of harm if treated were not treated. Do they benefit the most when treated? -->
<!-- Mediation Analysis. Povezano sa pitanjem Zasto? Mehanizmi. Reicmo da nam nestane narandza, da li mozemo da sprecimo skorbut? Razlikovanje indirektnih i direktnih efekata (onih koji ne idu kroz medijatora) -->
<!-- ## Case of Forgotten Scurvy -->
<!-- Citrus -\> Acid -\> Scurvy Sailors substituting lemon for lime 1/4 Vit C, cooking it South Pole expedition, dry meat no citrus -->
<!-- # Bajesova teorema -->
<!-- $$P(\theta|\textbf{D}) = \frac{P(\theta ) P(\textbf{D} | \theta)}{P(\textbf{D})}$$ -->
</section>
</section>
<section id="zaključak" class="level1">
<h1>Zaključak</h1>
<p>Ovo je bio kratak konceptualni uvod u kauzalne dijagrame. Pisao sam članak uglavnom sebi kao podsetnik, ali možda posluži kao uvod nekom ko je zainteresovan.</p>
<section id="reference" class="level3">
<h3 class="anchored" data-anchor-id="reference">Reference</h3>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list">
<div id="ref-cinelli2020" class="csl-entry" role="listitem">
Cinelli, C., Forney, A., &amp; Pearl, J. (2020). A Crash Course in Good and Bad Controls. <em>SSRN Electronic Journal</em>. <a href="https://doi.org/10.2139/ssrn.3689437">https://doi.org/10.2139/ssrn.3689437</a>
</div>
<div id="ref-hernán2018" class="csl-entry" role="listitem">
Hernán, M. A. (2018). The C-Word: Scientific Euphemisms Do Not Improve Causal Inference From Observational Data. <em>American Journal of Public Health</em>, <em>108</em>(5), 616–619. <a href="https://doi.org/10.2105/AJPH.2018.304337">https://doi.org/10.2105/AJPH.2018.304337</a>
</div>
<div id="ref-lazebnik2002" class="csl-entry" role="listitem">
Lazebnik, Y. (2002). Can a biologist fix a radio?<span></span>Or, what I learned while studying apoptosis. <em>Cancer Cell</em>, <em>2</em>(3), 179–182. <a href="https://doi.org/10.1016/S1535-6108(02)00133-2">https://doi.org/10.1016/S1535-6108(02)00133-2</a>
</div>
<div id="ref-mcelreath2021" class="csl-entry" role="listitem">
McElreath, R. (2021). <em>Regression, Fire, and Dangerous Things (1/3)</em>. <a href="https://elevanth.org/blog/2021/06/15/regression-fire-and-dangerous-things-1-3/">https://elevanth.org/blog/2021/06/15/regression-fire-and-dangerous-things-1-3/</a>
</div>
<div id="ref-pearl2018" class="csl-entry" role="listitem">
Pearl, J., &amp; Mackenzie, D. (2018). <em>The Book of Why: The New Science of Cause and Effect</em> (1st edition). Basic Books.
</div>
<div id="ref-westreich2013" class="csl-entry" role="listitem">
Westreich, D., &amp; Greenland, S. (2013). The Table&nbsp;2 Fallacy: Presenting and Interpreting Confounder and Modifier Coefficients. <em>American Journal of Epidemiology</em>, <em>177</em>(4), 292–298. <a href="https://doi.org/10.1093/aje/kws412">https://doi.org/10.1093/aje/kws412</a>
</div>
</div>


</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Fusnota</h2>

<ol>
<li id="fn1"><p>Poznata mantra statistike: “Korelacija ne znači kauzalnost.” Međutim, kauzalnost ne garantuje ni korelaciju.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Njegova motivacija je jasnija kad saznamo da je on bio prvi rođak Čarlsa Darvina. Zapravo, Galtona je zanimala naslednost inteligencije, kao i većinu tadašnjeg Britanskog noblesa opsednutog razlikama između sebe i “prostog” naroda.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Tipično za tadašnje tzv. visoko društvo.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>Ne samo regresiju, već bilo koji proces analize. Uključujući i nelinearne metode.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>Dobar primer medijativnog efekta je uticaj Vitamina C na kauzalnom putu: <span class="math inline">\(Citrus \rightarrow Vitamin\,C \rightarrow Skorbut\)</span>.<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Navođenje</h2><div><div class="quarto-appendix-secondary-label">BibTeX navođenje:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{n. grubor2023,
  author = {N. Grubor, Nikola},
  title = {Kauzalno zaključivanje je moguće iz opservacionih studija},
  date = {2023-08-07},
  url = {https://nikola-grubor.github.io/myblog/posts/sr/kauzalno-zakljucivanje},
  langid = {sr-Latn}
}
</code><button title="Kopiraj" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">Za pripisivanje autoru, molimo navedite ovaj rad sa:</div><div id="ref-n. grubor2023" class="csl-entry quarto-appendix-citeas" role="listitem">
N. Grubor, N. (2023, August 7). <em>Kauzalno zaključivanje je moguće iz
opservacionih studija</em>. <a href="https://nikola-grubor.github.io/myblog/posts/sr/kauzalno-zakljucivanje">https://nikola-grubor.github.io/myblog/posts/sr/kauzalno-zakljucivanje</a>
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Kopirano!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Kopirano!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/nikola-grubor\.github\.io");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>